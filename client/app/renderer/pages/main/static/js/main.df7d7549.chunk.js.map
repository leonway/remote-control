{"version":3,"sources":["../external \"electron\"","logo.svg","peer-puppet.js","App.js","reportWebVitals.js","index.js","../external \"events\""],"names":["module","exports","require","peer","EventEmitter","window","ipcRenderer","on","e","offer","console","log","pc","RTCPeerConnection","getScreenStream","a","desktopCapturer","getSources","types","sources","Promise","resolve","reject","navigator","webkitGetUserMedia","audio","video","mandatory","chromeMediaSource","chromeMediaSourceId","id","maxWidth","screen","width","maxHeight","height","stream","candidate","JSON","parse","addIceCandidate","RTCIceCandidate","addStream","setRemoteDescription","createAnswer","setLocalDescription","stringify","localDescription","ondatachannel","channel","onmessage","data","type","send","onicecandidate","then","answer","sdp","Menu","remote","MenuItem","App","useState","remoteCode","setRemoteCode","localCode","setLocalCode","controlText","setControlText","login","invoke","code","useEffect","handleControlState","removeListener","name","text","className","onContextMenu","preventDefault","menu","append","label","role","popup","handleContextMenu","value","onChange","target","onClick","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.df7d7549.chunk.js","sourcesContent":["module.exports = require(\"electron\");","export default __webpack_public_path__ + \"static/media/logo.6ce24c58.svg\";","import EventEmitter from 'events'\nimport { ipcRenderer, desktopCapturer } from 'electron'\nlet peer = new EventEmitter()\nwindow.peer = peer // 为了直接模拟过程，信令结束后，会删掉\nipcRenderer.on('offer', (e, offer) => {\n  console.log('init pc', offer)\n  const pc = new window.RTCPeerConnection()\n  pc.ondatachannel = (e) => {\n    console.log('data', e)\n    e.channel.onmessage = (e) => {\n      console.log('onmessage', e, JSON.parse(e.data))\n      let { type, data } = JSON.parse(e.data)\n      console.log('robot', type, data)\n      if (type === 'mouse') {\n        data.screen = {\n          width: window.screen.width,\n          height: window.screen.height,\n        }\n      }\n      ipcRenderer.send('robot', type, data)\n    }\n  }\n\n  async function getScreenStream() {\n    const sources = await desktopCapturer.getSources({ types: ['screen'] })\n    return new Promise((resolve, reject) => {\n      navigator.webkitGetUserMedia(\n        {\n          audio: false,\n          video: {\n            mandatory: {\n              chromeMediaSource: 'desktop',\n              chromeMediaSourceId: sources[0].id,\n              maxWidth: window.screen.width,\n              maxHeight: window.screen.height,\n            },\n          },\n        },\n        (stream) => {\n          console.log('add-stream', stream)\n          resolve(stream)\n        },\n        reject\n      )\n    })\n  }\n\n  pc.onicecandidate = (e) => {\n    if (e.candidate) {\n      // 告知其他人\n      ipcRenderer.send('forward', 'puppet-candidate', JSON.stringify(e.candidate))\n    }\n  }\n\n  async function addIceCandidate(candidate) {\n    candidate = typeof candidate === 'string' ? JSON.parse(candidate) : candidate\n    if (!candidate) return\n    console.log('addIceCandidate---candidate', candidate, typeof candidate)\n    await pc.addIceCandidate(new RTCIceCandidate(candidate))\n  }\n  window.addIceCandidate = addIceCandidate\n\n  async function createAnswer(offer) {\n    let stream = await getScreenStream()\n    pc.addStream(stream)\n    await pc.setRemoteDescription(offer)\n    await pc.setLocalDescription(await pc.createAnswer())\n    console.log('create answer \\n', JSON.stringify(pc.localDescription))\n    // send answer\n    return pc.localDescription\n  }\n  createAnswer(offer).then((answer) => {\n    ipcRenderer.send('forward', 'answer', { type: answer.type, sdp: answer.sdp })\n  })\n})\nexport default peer\n","import { useState, useEffect } from 'react'\nimport logo from './logo.svg'\nimport './App.css'\nimport { ipcRenderer, remote } from 'electron' // !直接用会报错 需要修改cra 配置通过react-app-rewired 修改默认webpack配置\n// const { ipcRenderer } = window.require('electron') // 第一种引用的方法\nimport './peer-puppet.js'\nconst { Menu, MenuItem } = remote\n\nfunction App() {\n  const [remoteCode, setRemoteCode] = useState('')\n  const [localCode, setLocalCode] = useState('')\n  const [controlText, setControlText] = useState('')\n  const login = async () => {\n    // console.log('login start')\n    let code = await ipcRenderer.invoke('login')\n    // console.log('login end code', code)\n    setLocalCode(code)\n  }\n  useEffect(() => {\n    login()\n    ipcRenderer.on('control-state-change', handleControlState)\n    return () => {\n      ipcRenderer.removeListener('control-state-change', handleControlState)\n    }\n  }, [])\n\n  const startControl = (code) => {\n    ipcRenderer.send('control', code)\n  }\n\n  const handleControlState = (e, name, type) => {\n    console.log('handleControlState')\n    let text = ''\n    if (type === 1) {\n      // 控制别人\n      text = `正在远程控制${name}`\n    } else if (type === 2) {\n      // 被控制\n      text = `被${name}控制中`\n    }\n    setControlText(text)\n  }\n  const handleContextMenu = (e) => {\n    e.preventDefault()\n    const menu = new Menu()\n    menu.append(new MenuItem({ label: '复制', role: 'copy' }))\n    menu.popup()\n  }\n  return (\n    <div className=\"App\">\n      {controlText === '' ? (\n        <>\n          <div>\n            你的控制码<span onContextMenu={(e) => handleContextMenu(e)}>{localCode}</span>\n          </div>\n          <input type=\"text\" value={remoteCode} onChange={(e) => setRemoteCode(e.target.value)} />\n          <br />\n          <button onClick={() => startControl(remoteCode)}>确认</button>\n        </>\n      ) : (\n        <div>{controlText}</div>\n      )}\n    </div>\n  )\n}\n\nexport default App\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","module.exports = require(\"events\");"],"sourceRoot":""}